---
title: "EDA Avito"
author: "LegenDad"
date: "2018-06-04"
output: 
  html_document:
    toc : true
    toc_float : 
      collapsed : false
    number_sections : true
    fig_width : 10
    fit_height : 4.5 
    code_folding : hide
    theme : journal
    highlight : espresso
---

# Introduction

![](https://www.vostoknewventures.com/wp-content/uploads/2015/08/Avito_new_Vostok_small.png)

From Description Page  

> In their fourth Kaggle competition, Avito is challenging you to predict demand for an online advertisement based on its full description (title, description, images, etc.), its context (geographically where it was posted, similar ads already posted) and historical demand for similar ads in similar contexts. With this information, Avito can inform sellers on how to best optimize their listing and provide some indication of how much interest they should realistically expect to receive.

<br>

18 Variables 

> * item_id - Ad id.
> * user_id - User id.
> * region - Ad region.
> * city - Ad city.
> * parent_category_name - Top level ad category as classified by Avito's ad model.
> * category_name - Fine grain ad category as classified by Avito's ad model.
> * param_1 - Optional parameter from Avito's ad model.
> * param_2 - Optional parameter from Avito's ad model.
> * param_3 - Optional parameter from Avito's ad model.
> * title - Ad title.
> * description - Ad description.
> * price - Ad price.
> * item_seq_number - Ad sequential number for user.
> * activation_date- Date ad was placed.
> * user_type - User type.
> * image - Id code of image. Ties to a jpg file in train_jpg. Not every ad has an image.
> * image_top_1 - Avito's classification code for the image.
> * deal_probability - The target variable. This is the likelihood that an ad actually sold something. It's not possible to verify every transaction with certainty, so this column's value can be any float from zero to one.


# Library & Importing {.tabset .tabset-fade .tabset-pills}

## Loading Library
```{r message=F, warning=F}
library(tidyverse)
library(knitr)
library(skimr)
library(DT)
library(ggthemes)
```
## Importing Data
```{r message=F, waring=F}
avi <- read_csv("../input/train.csv")
avite <- read_csv("../input/test.csv")
```

# Glimpse of Data {.tabset .tabset-fade .tabset-pills}

## Glimpse of train
```{r message=F, waring=F}
glimpse(avi)
```

## Summary of train
```{r message=F, waring=F}
summary(avi)
```

## Summary of test
```{r message=F, waring=F}
summary(avite)
```

# LookUp & NA {.tabset .tabset-fade .tabset-pills}

## Head train
```{r messagse=F, waring=F}
head(avi, 50) %>% datatable(filter = 'top', 
                            options = list(pageLength = 10, autoWidth = T))

```


## Head test
```{r messagse=F, waring=F}
head(avite, 50) %>% datatable(filter = 'top', 
                            options = list(pageLength = 10, autoWidth = T))

```

## NA
```{r message=F, waring=F}
avi_na <- sapply(avi, function(x) sum(is.na(x)))
avite_na <- sapply(avite, function(x) sum(is.na(x)))
avi_na[avi_na >0]; avite_na[avite_na >0]

```


# Variables

## item_id {.tabset .tabset-fade .tabset-pills}

### train
```{r echo=TRUE, message=F, waring=F}
paste("All item_id are unique?", length(unique(avi$item_id)) == nrow(avi))
```
### test
```{r echo=TRUE, message=F, waring=F}
paste("All item_id are unique?", length(unique(avite$item_id)) == nrow(avite))
```
all unique item_id

## user_id {.tabset .tabset-fade .tabset-pills}

### train unique proportion
```{r message=F, warning=F}
length(unique(avi$user_id)) / nrow(avi)
```

### test unique proportion
```{r message=F, warning=F}
length(unique(avite$user_id)) / nrow(avi)
```

### Most popular user_id

```{r message=F, warning=F}
avi %>% group_by(user_id) %>% summarise(Count=n()) %>% 
  arrange(desc(Count)) %>% head(20) %>% 
  ggplot(aes(x=reorder(user_id, Count), y=Count)) + 
  geom_col(fill="steelblue") + coord_flip() +
  labs(x="User ID", y="Count", title = "Most Popular User ID")
```


## region {.tabset .tabset-fade .tabset-pills}

### train
```{r, message=F, warning=F}
region <- c("Краснодарский край","Свердловская область", 
            "Ростовская область","Татарстан","Челябинская область",
            "Нижегородская область","Самарская область",
            "Башкортостан","Пермский край","Новосибирская область",
            "Ставропольский край","Ханты-Мансийский АО",
            "Воронежская область","Иркутская область",
            "Тульская область","Тюменская область","Белгородская область")
region_en <- c("Krasnodar","Sverdlovsk","Rostov","Tatarstan", 
               "Chelyabinsk","Nizhny Novgorod","Samara", 
               "Bashkortostan","Perm","Novosibirsk", 
               "Stavropol","Khanty-Mansiysk Autonomous Okrug", 
               "Voronezh","Irkutsk","Tula","Tyumen","Belgorod")

df_regions_en <- as.data.frame(cbind(region,region_en))

avi %>% group_by(region) %>% summarise(Count = n()) %>%
  arrange(desc(Count)) %>% head(10)  

```
### most popular region in train

```{r, message=F, warning=F}
avi %>% group_by(region) %>% summarise(Count = n()) %>%
  arrange(desc(Count)) %>% head(10) %>% left_join(df_regions_en) %>%
  mutate(region_en = reorder(region_en, Count)) %>%
  ggplot(aes(x=region_en, y=Count)) + 
  geom_col() + coord_flip() + theme_wsj() +
  geom_text(aes(x=region_en, y = 1, label=paste(round((Count/nrow(avi))*100,2), "%")), 
            hjust = 0, vjust =.5,  fontface = 'bold', color="orange") + 
  labs(x='region', y='count', title = 'Most Popular Region')
```

### most popular region in test

```{r, message=F, warning=F}
avite %>% group_by(region) %>% summarise(Count = n()) %>%
  arrange(desc(Count)) %>% head(10) %>% left_join(df_regions_en) %>%
  mutate(region_en = reorder(region_en, Count)) %>%
  ggplot(aes(x=region_en, y=Count)) + 
  geom_col() + coord_flip() + theme_wsj() +
  geom_text(aes(x=region_en, y = 1, label=paste(round((Count/nrow(avi))*100,2), "%")), 
            hjust = 0, vjust =.5,  fontface = 'bold', color="orange") + 
  labs(x='region', y='count', title = 'Most Popular Region')

```

### Distribution of Deal Probablity
```{r, message=F, warning=F}
region_dt <- avi %>% group_by(region) %>% summarise(Count = n()) %>% 
  arrange(desc(Count)) %>% head(10)
avi %>% filter(region %in% region_dt$region) %>%
  ggplot(aes(x=factor(region), y=deal_probability, fill= region)) +
  geom_boxplot() + theme_bw() + 
  labs(x='Region', y="Deal Probablity", title="Distribution of Deal Probablity") + 
  theme(axis.text.x = element_text(angle=90, hjust = 1))
```

## city {.tabset .tabeset-fade .tabset-pills}

### most popular city on Graph
```{r, message=F, warning=F}
city <-c("Краснодар","Екатеринбург","Новосибирск","Ростов-на-Дону","Нижний Новгород",
         "Челябинск","Пермь","Казань","Самара","Омск")

city_en <-c("Krasnodar","Ekaterinburg","Novosibirsk","Rostov-na-Donu",
            "Nizhny Novgorod", "Chelyabinsk","Permian","Kazan","Samara","Omsk")

df_city_en <- as.data.frame(cbind(city,city_en) )

avi %>% group_by(city) %>% summarise(Count = n()) %>%
  arrange(desc(Count)) %>% head(10) %>% left_join(df_city_en) %>% 
  mutate(city_en = reorder(city_en, Count)) %>% 
  ggplot(aes(x=city_en, y=Count)) + 
  labs(x='City', y= 'Count', title = 'Most Popular City') + 
  geom_col() + coord_flip() + theme_wsj()

```

### most popular city on Data
```{r, message=F, warning=F}
avi %>% group_by(city) %>% summarise(Count = n()) %>%
  arrange(desc(Count)) %>% head(10) %>% left_join(df_city_en) %>% datatable()

```





## parent_category_name 
## category_name       
## param_1              
## param_2              
## param_3             
## title                
## description          
## price               
## item_seq_number      
## activation_date      
## user_type           
## image                
## image_top_1          
## deal_probability    